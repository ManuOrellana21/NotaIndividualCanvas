
<!DOCTYPE html>
<html>
<head>
<title>Animacion Con Canvas</title>

<!-- Importar EaselJS Framework -->
<script src="https://code.createjs.com/easeljs-0.6.0.min.js"></script>

<script>
var canvas;
var stage;
var screen_width;
var screen_height;
var bmpAnimation;

var imgMonsterARun = new Image();

function init() {
    canvas = document.getElementById("testCanvas");

    imgMonsterARun.onload = handleImageLoad;
    imgMonsterARun.onerror = handleImageError;
    imgMonsterARun.src = "MonsterARun.jpg";
}

function reset() {
    stage.removeAllChildren();
    createjs.Ticker.removeAllListeners();
    stage.update();
}

function handleImageLoad(e) {
    startGame();
}

function startGame() {
	// crear un nuevo escenario y lo señala en nuestros lienzo:
	stage = new createjs.Stage(canvas);
	
	// agarrar la anchura de la lona y la altura para los cálcu
	screen_width = canvas.width;
	screen_height = canvas.height;
	
    // crear hoja de sprites y asigna los datos asociados.
	var spriteSheet = new createjs.SpriteSheet({
	    // imagen a utilizar
	    images: [imgMonsterARun], 
	    // anchura, altura y registro de punto de cada sprite
	    frames: {width: 64, height: 64, regX: 32, regY: 32}, 
	    animations: {	
		    walk: [0, 9, "walk"]
	    }
    });
	
    // crear una instancia BitmapAnimation para mostrar y reproducir la hoja de sprites:
	bmpAnimation = new createjs.BitmapAnimation(spriteSheet);

    // iniciar la reproducción de la primera secuencia:
    bmpAnimation.gotoAndPlay("walk"); 	//animate
	
    // Configurar una sombra. Tenga en cuenta que las sombras son ridículamente caro. Se podría mostrar cientos
    // De ratas animados si se desactivaba la sombra.
    bmpAnimation.shadow = new createjs.Shadow("#454", 0, 5, 4);

    bmpAnimation.name = "monster1";
    bmpAnimation.direction = 90;
    bmpAnimation.vX = 4;
    bmpAnimation.x = 16;
    bmpAnimation.y = 32;
		
    // Que cada inicio monstruo a la trama específica
    bmpAnimation.currentFrame = 0;
    stage.addChild(bmpAnimation);
		
    // Queremos hacer un trabajo antes de que se actualice el lienzo,
    // De lo contrario podríamos utilizar Ticker.addListener (etapa);
    createjs.Ticker.addListener(window);
    createjs.Ticker.useRAF = true;
    createjs.Ticker.setFPS(60);
}

// Llamada si hay un error al cargar la imagen (por lo general debido a un 404)
function handleImageError(e) {
	console.log("Error Loading Image : " + e.target.src);
}

function tick() {
    // Hit probar el ancho de la pantalla, de lo contrario nuestra sprites desaparecería
    if (bmpAnimation.x >= screen_width - 16) {
       // Hemos llegado a la parte derecha de la pantalla 
       // Tenemos que caminar a la izquierda ahora que volver a nuestra posición inicial
        bmpAnimation.direction = -90;
    }

    if (bmpAnimation.x < 16) {
        // Hemos llegado a la parte izquierda de la pantalla 
        // Necesitamos caminar en este momento
        bmpAnimation.direction = 90;
    }

    // Mover el sprite basado en la dirección y la velocidad
    if (bmpAnimation.direction == 90) {
        bmpAnimation.x += bmpAnimation.vX;
    }
    else {
        bmpAnimation.x -= bmpAnimation.vX;
    }

    // Actualizar la etapa:
    stage.update();
}

</script>
</head>
	
<body>
	<div class="description">

	</div>
	<div class="canvasHolder">
		<canvas id="testCanvas" width="240" height="64" style="background-color:#607559">
            Su navegador no soporta lienzo. Por favor, descargar IE9  <a href="http://ie.microsoft.com/testdrive">IE Test Drive</a> 
        </canvas>
	</div>
    <button id="Start" onclick=init();>Start</button><button id="Reset" onclick=reset();>Reset</button>
</body>
</html>
